import{a as j,r as h,R as oe,I as ie,j as s,b as m,T as ce,B as le,s as G,c as ue,d as re,F as R,e as de,M as fe,f as me,g as he,h as pe,_ as Y,i as ee,u as se,k as we,l as xe,m as ge,n as Fe,o as Ne,p as ve,q as K,t as Q,v as X,w as ye}from"./index.741120c7.js";import{S as Be}from"./index.1e87a670.js";import{l as te}from"./login.42f3cdda.js";async function Ce(){return j.send("getNetInfo")}const Ee=async e=>{var a;const n=await j.send("fetchPlatformList",{cookie:e}),c=(a=await window.storage.get("nameStore"))!=null?a:{};return n.data.list.forEach(u=>{const l=c[u.id],r=c[u.ip];if(!(!l&&!r)){if(l===r){u.name=l;return}r&&(u.name=r)}}),n},ne=async(e,n)=>j.send("offlinePlatform",{link:e,cookie:n}),Se=async({username:e,password:n})=>j.send("connect",{username:e,password:n}),ke=e=>{const[n,c]=h.exports.useState(0),[a,u]=h.exports.useState(0),[l,r]=h.exports.useState([]),[d,N]=h.exports.useState(0),[o,B]=h.exports.useState(0),[A,C]=h.exports.useState(0);return h.exports.useEffect(()=>{if(!e)return;const w=setInterval(()=>{const x=window.navigator.connection;x&&(B(x.downlink),C(x.rtt));const v=new Image,S=new Date().getTime();v.src=`https://www.baidu.com/favicon.ico?d=${S}`,v.onload=()=>{const i=new Date().getTime()-S;if((a+1)%5===0){const f=Math.max(i,...l),p=Math.min(i,...l);N(f-p),r([])}else r(f=>[...f,i]);u(a+1),c(i)},v.onerror=E=>{console.error("useSpeed:error",E)}},5e3);return()=>{clearInterval(w)}},[a,l,e]),[n,d,o,A]};function Ae(e,n){const c=h.exports.useContext(ie),a=c.prefixCls,u=a===void 0?"arco":a,l=e.spin,r=e.className,d={"aria-hidden":!0,focusable:!1,ref:n,...e,className:`${r?r+" ":""}${u}-icon ${u}-icon-sync`};return l&&(d.className=`${d.className} ${u}-icon-loading`),delete d.spin,delete d.isIcon,s("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...d,children:s("path",{d:"M11.98 11.703c-6.64 6.64-6.64 17.403 0 24.042a16.922 16.922 0 0 0 8.942 4.7M34.603 37.156l1.414-1.415c6.64-6.639 6.64-17.402 0-24.041A16.922 16.922 0 0 0 27.075 7M14.81 11.982l-1.414-1.414-1.414-1.414h2.829v2.828ZM33.192 36.02l1.414 1.414 1.414 1.415h-2.828V36.02Z"})})}const _=oe.forwardRef(Ae);_.defaultProps={isIcon:!0};_.displayName="IconSync";const Ie=_,$e=({ip:e,name:n,startTime:c,endTime:a,beforeNode:u,afterNode:l,className:r="",id:d,onChange:N,current:o})=>{const B=new Date(c).getTime(),C=(a?new Date(a):new Date).getTime()-B,w=Math.floor(C/(24*3600*1e3)),x=C%(24*3600*1e3),v=Math.floor(x/(3600*1e3)),S=x%(3600*1e3),E=Math.floor(S/(60*1e3)),i=w>0?`${w}d ${v}h ${E}min`:`${v}h ${E}min`;return m("div",{className:`flex flex-row w-full py-[10px] px-[18px] justify-between items-center ${r}`,children:[u,m("span",{className:"w-[135px]",children:[o!==void 0&&s(ce,{content:"\u672C\u673A",children:s("span",{className:`mr-2 transition-all cursor-default ${o?"visible":"invisible"}`,children:"\u25B6"})}),e]}),s(le,{className:`mr-[15px] overflow-hidden text-clip ${G["ip-row-input"]}`,defaultValue:n!=null?n:"",placeholder:"\u8F93\u5165\u8BBE\u5907\u540D",onFinished:f=>N==null?void 0:N({val:f,id:d,ip:e})}),s("span",{className:"w-[175px] select-text",children:c}),s("span",{className:`w-[70px] ${G["ip-row-status"]}`,"data-status":!a,children:a?"\u79BB\u7EBF":"\u5728\u7EBF"}),s("span",{className:"w-[144px]",children:i}),l]})},{Title:Pe}=Y,De=({platformList:e,currentIP:n,onOffline:c,onNameChange:a,onFlush:u})=>{const l=h.exports.useMemo(()=>e===null?s("div",{className:"flex justify-center items-center w-full h-[140px]",children:s(ue,{spin:!0})}):e.length===0?s("div",{className:"flex justify-center items-center w-full h-[140px]",children:s(re,{})}):e.map(o=>s($e,{current:o.ip===n,afterNode:m(R,{children:[s(de,{className:"ml-6 whitespace-nowrap",theme:"danger",onClick:()=>c(o),disabled:o.endTime!==null,children:"\u4E0B\u7EBF"}),s(fe,{triggerClassName:"ml-3",infoList:[o.id,o.nasIP]})]}),onChange:a,...o},o.id)),[e]),[r,d]=h.exports.useState(!1);return m(R,{children:[m(Pe,{className:"mb-2 ml-1 flex flex-row items-center",children:[s(me,{position:"right",content:"\u57FA\u4E8EIP\u548C\u4F1A\u8BDDID\u662F\u5426\u76F8\u540C\u5224\u65AD\u662F\u5426\u4E3A\u540C\u4E00\u8BBE\u5907\uFF0C\u6682\u65F6\u65E0\u6CD5\u89C4\u907FIP\u53D8\u52A8\u5BFC\u81F4\u81EA\u5B9A\u4E49\u8BBE\u5907\u540D\u79F0\u4E22\u5931\u7684\u60C5\u51B5",children:s("svg",{className:"icon mr-1 cursor-help",children:s("use",{xlinkHref:"#icon-xiangmu"})})}),s("span",{children:"\u8BBE\u5907\u5217\u8868"}),s("div",{onClick:()=>{const o=setTimeout(()=>{d(!0)},200);u().finally(()=>{clearTimeout(o),d(!1)})},children:s(Ie,{className:"ml-2 cursor-pointer",spin:r})})]}),s(he,{className:`min-h-[145px] ${pe["platform-list"]}`,autoHeight:!0,children:l})]})},D=({name:e,value:n,type:c})=>m("div",{className:"flex flex-row items-center justify-between",children:[m("div",{className:"flex flex-row items-center font-bold",children:[s(Be,{className:"mr-1",type:c}),s("span",{className:"mr-1 mt-[1px] text-xs select-text",children:e})]}),s("span",{className:"opacity-80 hover:opacity-100 transition-opacity select-text",children:n})]}),be=({netInfo:e,className:n=""})=>{var c,a;return m(ee,{title:"\u7F51\u7EDC\u4FE1\u606F",className:`${n}`,children:[s(D,{name:"IP",value:e.ip.value,type:e.ip.type}),s(D,{name:"DNS",value:(c=e.dns.value[0])!=null?c:"",type:e.dns.type}),e.dns.value[1]&&s(D,{name:"",value:(a=e.dns.value[1])!=null?a:"",type:"normal"}),e.wifiName&&s(D,{name:"WIFI",value:e.wifiName.value,type:e.wifiName.type}),s(D,{name:"DHCP",value:e.dhcp.value,type:e.dhcp.type})]})},{Title:Me}=Y,Te=()=>{var n,c;const{currentDuty:e}=se(a=>a.center);return s("div",{className:"flex flex-col mt-4",children:e?m(R,{children:[m(Me,{className:"ml-3",children:["\u5F53\u524D\u503C\u73ED",e!=null&&e.name?`\uFF1A${e==null?void 0:e.name}`:""]}),s(ee,{className:"mt-1 h-full",title:"",itemClassName:"w-full h-full mt-0",listClassName:"w-full h-full",children:m("div",{className:"flex flex-col items-center justify-evenly max-h-full h-full",children:[s("p",{children:e==null?void 0:e.desc}),s(xe,{allowHalf:!0,readonly:!0,value:(n=e==null?void 0:e.rate)!=null?n:0}),s("img",{className:"object-cover rounded-[9px] mt-3 select-none overflow-hidden",width:180,height:180,src:(c=e==null?void 0:e.avatarUrl)!=null?c:""})]})})]}):s("div",{className:"w-full flex flex-col items-center h-[200px] justify-center",children:s(we,{size:"large"})})})},je="/sztunethelper/assets/connecting.0abcdb2e.mp4",Re="/sztunethelper/assets/logging.63b4645c.mp4",_e="/sztunethelper/assets/no-net.83c5971a.svg",Le=async(e,n)=>{var a,u;const c=await te(n);await ne(e,(u=(a=c.data)==null?void 0:a.cookies)!=null?u:"")},Oe=()=>{const e=ge(),n=Fe(),c=Ne(["/index"]),a=ve(),u=c===null,[l,r]=h.exports.useState([]),[d,N]=h.exports.useState("offline"),o=i=>{window.storage.set("netStatus",i),N(i)},B=se(i=>i.netInfo),[A,C]=ke(d==="success"),w=async i=>{var H,W,z,O,U,V,M,Z,q;const f=await window.storage.get("username"),p=await window.storage.get("password");if(console.info("login:username",f),!f||!p){o("offline"),n.push("/login");return}const g=async()=>{if(console.info("init#getCookie:start"),sessionStorage.getItem("cookie")&&i!=="refresh"){o("connect");return}const F=await te({username:f,password:p});F.code===200?(sessionStorage.setItem("cookie",F.data.cookies),o("connect")):o("offline"),console.info("init#getCookie:end")},b=async()=>{try{const t=await Ce();if(t.code===200)return e(ye(t.data)),t.data}catch(t){console.error(t)}return null},I=async(t,F)=>{if(t===null)return;r(null);const y=await Ee(t);r(y.data.list);const P=y.data.list.find(T=>T.ip===F);!P||await window.storage.set("currentPlatform",P)},$=async(t,F)=>{var P,T,J;const y=await window.storage.get("currentPlatform");if(y&&y.user!==f){const k=(P=await window.storage.get("accountStore"))!=null?P:[];await Le(y.link,{username:y.user,password:(J=(T=k.find(ae=>ae.username===y.user))==null?void 0:T.password)!=null?J:""})}try{const k=await Se({username:f,password:p});k.code===200?(o("success"),k.msg==="login success"&&await I(t,F)):o("offline")}catch(k){console.error(k)}},L=()=>{X.confirm({title:"\u8054\u7F51\u63D0\u793A",content:"\u522B\u6025\uFF01\u5173\u6389\u7CFB\u7EDF\u5F39\u51FA\u7684\u4E0A\u7F51\u8BA4\u8BC1\u7A97\u53E3\uFF0C\u70B9\u51FB\u786E\u8BA4\u5373\u53EF\uFF01",onOk:()=>{n.push("/index?refresh")},hideCancel:!0}),o("offline")};try{const t=await b();if(((H=t==null?void 0:t.wifiName)==null?void 0:H.type)==="fail")throw new Error("\u672A\u8FDE\u63A5\u6307\u5B9AWIFI");await g();const F=sessionStorage.getItem("cookie");await I(F,(W=t==null?void 0:t.ip)==null?void 0:W.value),$(F,(z=t==null?void 0:t.ip)==null?void 0:z.value)}catch(t){if(console.error("error:init",t),t.message==="\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"){Q.error({content:"\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"}),o("offline");return}if((t==null?void 0:t.code)===502&&((O=t==null?void 0:t.data)==null?void 0:O.code)===-1&&((U=t==null?void 0:t.data)==null?void 0:U.cookies)===null){Q.error({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8D26\u53F7\u5BC6\u7801\u662F\u5426\u6B63\u786E"}),o("offline"),n.push("/login");return}if((t==null?void 0:t.code)===-1&&((Z=(M=(V=t==null?void 0:t.data)==null?void 0:V.message)==null?void 0:M.includes)==null?void 0:Z.call(M,"connect ENETUNREACH 47.98.217.39"))){L();return}if((t==null?void 0:t.code)===502&&((q=t==null?void 0:t.data)==null?void 0:q.code)===-10056){L();return}}},x=h.exports.useCallback(()=>{d==="offline"&&(o("logging"),w())},[d]),v=i=>{X.confirm({title:"\u786E\u8BA4\u4E0B\u7EBF",content:`\u786E\u8BA4\u4E0B\u7EBF${i.ip}\u5417\uFF1F`,onOk:async()=>{var f,p;ne(i.link,(f=sessionStorage.getItem("cookie"))!=null?f:""),i.ip===B.ip.value&&o("offline"),r((p=l==null?void 0:l.map(g=>g.link===i.link?{...g,endTime:new Date().format("yyyy-MM-dd hh:mm:ss")}:g))!=null?p:null)}})},S=async({val:i,id:f,ip:p})=>{var b,I;const g=(b=await window.storage.get("nameStore"))!=null?b:{};r((I=l==null?void 0:l.map($=>$.id===f?{...$,name:i}:$))!=null?I:null),g[f]=i,g[p]=i,await window.storage.set("nameStore",g)},E=h.exports.useMemo(()=>{const i=(()=>{switch(d){case"offline":return s("img",{src:_e,width:270});case"logging":return s("video",{autoPlay:!0,loop:!0,src:Re,width:360,className:"mix-blend-multiply",preload:"auto"});case"connect":return s("video",{autoPlay:!0,loop:!0,src:je,width:360,className:"mix-blend-color-burn",preload:"auto"});default:return m("div",{className:"text-3xl",children:[m("div",{children:["\u5EF6\u8FDF\uFF1A",A,"ms"]}),m("div",{children:["\u6296\u52A8\uFF1A",C,"ms"]})]})}})();return s("div",{className:`w-full min-h-[380px] h-full mt-6 rounded-[15px] ${K["main__background-card"]} ${K[`main__background-card__${d}`]}`,onClick:x,children:s("div",{className:"w-full h-full flex items-center justify-center text-[45px]",children:i})})},[d,x,A,C]);return h.exports.useEffect(()=>{w()},[]),h.exports.useEffect(()=>{a.search==="?refresh"&&w("refresh")},[a]),s("div",{className:`main ${u?"main-hidden":""}`,children:m("div",{className:"flex flex-grow-0 flex-shrink-0 w-full h-full",children:[m("div",{className:"flex flex-col h-full max-w-[220px]",children:[s(be,{className:"min-w-[220px]",netInfo:B}),s(Te,{})]}),m("div",{className:"flex flex-col ml-6 w-full h-full",children:[s(De,{platformList:l,currentIP:B.ip.value,onOffline:v,onNameChange:S,onFlush:w}),E]})]})})};export{Oe as default};
