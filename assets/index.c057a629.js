import{f as b,R as E,r as w,I as D,j as m,a as t,l as k,o as B,E as A,k as F,i as v,S as T,n as $,_ as R,G as I,P as S}from"./index.44e23d23.js";import{S as j}from"./index.b86b39fe.js";async function L(){return b.send("getNetTasks")}async function _({id:n,data:c}){return b.send("runNetTask",{id:n,data:c})}function M(n,c){const l=w.exports.useContext(D),i=l.prefixCls,a=i===void 0?"arco":i,p=n.spin,h=n.className,d={"aria-hidden":!0,focusable:!1,ref:c,...n,className:`${h?h+" ":""}${a}-icon ${a}-icon-right-circle`};return p&&(d.className=`${d.className} ${a}-icon-loading`),delete d.spin,delete d.isIcon,m("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...d,children:[t("circle",{cx:"24",cy:"24",r:"18"}),t("path",{d:"M19.485 15.515 27.971 24l-8.486 8.485"})]})}const g=E.forwardRef(M);g.defaultProps={isIcon:!0};g.displayName="IconRightCircle";const P=g,H=({children:n,className:c="",type:l,onClick:i,onGo:a})=>m("div",{className:`flex items-center justify-between relative p-3 w-full cursor-pointer ${["success","fail"].includes(l)?"group":""} ${c}`,onClick:()=>i==null?void 0:i(n),children:[t("span",{children:n}),t(j,{type:l}),t("i",{className:"p-2 absolute right-8 invisible group-hover:visible",onClick:p=>{p.stopPropagation(),a==null||a(n)},children:t(P,{})})]}),O=({onClick:n,onGo:c,list:l})=>t(k,{children:l.map((i,a)=>t(H,{type:i.type,onClick:()=>{n==null||n(i)},onGo:()=>{c==null||c(i)},children:i.title},a))}),{Title:U}=R,z=[],q=()=>{const[n,c]=w.exports.useState(z),[l,i]=w.exports.useState(null),a=B(e=>e.netInfo);w.exports.useEffect(()=>{L().then(e=>{c(e.data)})},[]);const p=e=>{const o=`netTaskResult-${e.id}`,r=document.getElementById(o);r&&r.scrollIntoView({behavior:"smooth",block:"start"})},h=async e=>{var N,u;const o=(s,f)=>{c(y=>y.map(C=>(C.id===s&&(C.type=f),C)))};o(e.id,"loading");let r;const x=await _({id:e.id,data:(u=(N=a==null?void 0:a.dns)==null?void 0:N.value)==null?void 0:u[0]}).catch(s=>{o(e.id,"fail"),console.error("runNetTask:error",s,e),r={data:s==null?void 0:s.data,code:-1}});x&&(r=x),i(s=>s===null?[{id:e.id,content:r.data,title:e.title}]:s.some(f=>f.id===e.id)?s.map(f=>(f.id===e.id&&(f.content=r.data),f)):[...s,{id:e.id,content:r.data,title:e.title}]),x&&o(e.id,"success"),setTimeout(()=>{p({...e})},100)},d=async()=>{if(!l)return;const e=l==null?void 0:l.map(s=>({title:s.title,content:s.content})),o=await window.storage.get("username"),r=a&&Object.keys(a).map(s=>({title:s,content:typeof a[s].value!="object"?String(a[s].value):a[s].value.join("\u3001")})),N=await I(t(S,{data:e,netInfoData:r,name:o})).toBlob(),u=document.createElement("a");u.href=URL.createObjectURL(N),u.download=`\u7F51\u7EDC\u8BCA\u65AD\u62A5\u544A-${new Date().format("yyyyMMdd_hhmmss")}.pdf`,u.target="_blank",u.rel="noopener noreferrer",u.click()};return t("div",{className:`${A.container} main`,children:m("div",{className:"flex flex-row w-full flex-1",children:[m("div",{className:"w-[270px] min-w-[270px] flex flex-col flex-none",children:[m(U,{className:"mb-2 ml-1 flex flex-row items-center justify-between",children:[t(F,{position:"right",content:"\u81EA\u52A9\u670D\u52A1\u4E3A\u60A8\u63D0\u4F9B\u4E86\u672C\u673A\u7F51\u7EDC\u73AF\u5883\u7684\u68C0\u6D4B\uFF0C\u5E2E\u52A9\u60A8\u5FEB\u901F\u5C06\u7F51\u7EDC\u8BCA\u65AD\u62A5\u544A\u8F93\u51FA",children:m("div",{className:"flex flex-row items-center",children:[t("svg",{className:"icon mr-1 mt-0.5 cursor-help",children:t("use",{xlinkHref:"#icon-project"})}),t("span",{children:"\u81EA\u52A9\u670D\u52A1"})]})}),t(v,{onClick:()=>{c(n.map(e=>({...e,type:"loading"}))),n.forEach((e,o)=>{setTimeout(()=>{h(e)},o*100+1e3)})},children:"\u5168\u90E8\u8F93\u51FA"})]}),t(O,{list:n,onClick:h,onGo:p})]}),m("div",{className:"flex flex-col w-full ml-4 overflow-hidden",children:[t(T,{h:450,className:`flex flex-col items-center w-full ${A["small-screen"]}`,status:"done",nomoreNode:null,children:l&&l.map((e,o)=>t($,{scale:"1",title:e.title,className:`w-[97.5%] mb-3 ${o===0?"mt-3":""}`,id:`netTaskResult-${e.id}`,itemClassName:"overflow-hidden elipsis",titleClassName:"select-text",children:t("span",{className:"opacity-80 whitespace-pre-wrap select-text",children:e.content})},e.id))}),t("div",{className:"flex flex-row mt-4",children:t(v,{theme:"primary",size:"large",className:"w-full",onClick:d,disabled:l===null,children:"\u4E0B\u8F7D"})})]})]})})};export{q as default};
