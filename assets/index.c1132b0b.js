import{a as v,R as k,r as x,I as B,b as f,j as t,g as F,o as T,u as D,y,f as R,e as b,S as I,i as S,_ as j,P as L,z as _}from"./index.8fe12b5a.js";import{S as M}from"./index.6e4a88c3.js";async function P(){return v.send("getNetTasks")}async function z({id:n,data:c}){return v.send("runNetTask",{id:n,data:c})}function H(n,c){const o=x.exports.useContext(B),a=o.prefixCls,s=a===void 0?"arco":a,p=n.spin,m=n.className,u={"aria-hidden":!0,focusable:!1,ref:c,...n,className:`${m?m+" ":""}${s}-icon ${s}-icon-right-circle`};return p&&(u.className=`${u.className} ${s}-icon-loading`),delete u.spin,delete u.isIcon,f("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...u,children:[t("circle",{cx:"24",cy:"24",r:"18"}),t("path",{d:"M19.485 15.515 27.971 24l-8.486 8.485"})]})}const w=k.forwardRef(H);w.defaultProps={isIcon:!0};w.displayName="IconRightCircle";const U=w,O=({children:n,className:c="",type:o,onClick:a,onGo:s})=>f("div",{className:`flex items-center justify-between relative p-3 w-full cursor-pointer ${["success","fail"].includes(o)?"group":""} ${c}`,onClick:()=>a==null?void 0:a(n),children:[t("span",{children:n}),t(M,{type:o}),t("i",{className:"p-2 absolute right-8 invisible group-hover:visible",onClick:p=>{p.stopPropagation(),s==null||s(n)},children:t(U,{})})]}),V=({onClick:n,onGo:c,list:o})=>t(F,{children:o.map((a,s)=>t(O,{type:a.type,onClick:()=>{n==null||n(a)},onGo:()=>{c==null||c(a)},children:a.title},s))}),{Title:W}=j,q=[],Q=()=>{const c=T(["/self_help"])===null,[o,a]=x.exports.useState(q),[s,p]=x.exports.useState(null),m=D(e=>e.netInfo);x.exports.useEffect(()=>{P().then(e=>{a(e.data)})},[]);const u=e=>{const i=`netTaskResult-${e.id}`,l=document.getElementById(i);l&&l.scrollIntoView({behavior:"smooth",block:"start"})},C=async e=>{var A,g;const i=(r,d)=>{a($=>$.map(N=>(N.id===r&&(N.type=d),N)))};i(e.id,"loading");let l;const h=await z({id:e.id,data:(g=(A=m==null?void 0:m.dns)==null?void 0:A.value)==null?void 0:g[0]}).catch(r=>{i(e.id,"fail"),console.error("runNetTask:error",r,e),l={data:r==null?void 0:r.data,code:-1}});h&&(l=h),p(r=>r===null?[{id:e.id,content:l.data,title:e.title}]:r.some(d=>d.id===e.id)?r.map(d=>(d.id===e.id&&(d.content=l.data),d)):[...r,{id:e.id,content:l.data,title:e.title}]),h&&i(e.id,"success"),setTimeout(()=>{u({...e})},100)},E=async()=>{if(!s)return;const e=t(L,{data:s==null?void 0:s.map(h=>({title:h.title,content:h.content}))}),i=await _(e).toBlob(),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=`\u7F51\u7EDC\u8BCA\u65AD\u62A5\u544A-${new Date().format("yyyyMMdd_hhmmss")}.pdf`,l.target="_blank",l.rel="noopener noreferrer",l.click()};return t("div",{className:`${y.container} main ${c?"main-hidden":""}`,children:f("div",{className:"flex flex-row w-full flex-1",children:[f("div",{className:"w-[270px] min-w-[270px] flex flex-col flex-none",children:[f(W,{className:"mb-2 ml-1 flex flex-row items-center justify-between",children:[t(R,{position:"right",content:"\u81EA\u52A9\u670D\u52A1\u4E3A\u60A8\u63D0\u4F9B\u4E86\u672C\u673A\u7F51\u7EDC\u73AF\u5883\u7684\u68C0\u6D4B\uFF0C\u5E2E\u52A9\u60A8\u5FEB\u901F\u5C06\u7F51\u7EDC\u8BCA\u65AD\u62A5\u544A\u8F93\u51FA",children:f("div",{className:"flex flex-row items-center",children:[t("svg",{className:"icon mr-1 mt-0.5 cursor-help",children:t("use",{xlinkHref:"#icon-project"})}),t("span",{children:"\u81EA\u52A9\u670D\u52A1"})]})}),t(b,{onClick:()=>{a(o.map(e=>({...e,type:"loading"}))),o.forEach((e,i)=>{setTimeout(()=>{C(e)},i*100+1e3)})},children:"\u5168\u90E8\u8F93\u51FA"})]}),t(V,{list:o,onClick:C,onGo:u})]}),f("div",{className:"flex flex-col w-full ml-4 overflow-hidden",children:[t(I,{h:450,className:`flex flex-col items-center w-full ${y["small-screen"]}`,status:"done",nomoreNode:null,children:s&&s.map((e,i)=>t(S,{scale:"1",title:e.title,className:`w-[97.5%] mb-3 ${i===0?"mt-3":""}`,id:`netTaskResult-${e.id}`,itemClassName:"overflow-hidden elipsis",titleClassName:"select-text",children:t("span",{className:"opacity-80 whitespace-pre-wrap select-text",children:e.content})},e.id))}),t("div",{className:"flex flex-row mt-4",children:t(b,{theme:"primary",size:"large",className:"w-full",onClick:E,disabled:s===null,children:"\u4E0B\u8F7D"})})]})]})})};export{Q as default};
