import{R as v,H as ge,J as L,K as _,N as se,j as c,O as xe,r as N,Q as Ce,U as Ee,V as Ne,W as we,X as Fe,Y as be,b as d,Z as re,c as ke,F as Z,a as Y,I as le,$ as Se,a0 as $e,a1 as Ie,a2 as ce,f as Te,g as Be,_ as He,v as B,t as Ae,a3 as De,m as K,a4 as T,u as V,a5 as Oe,a6 as W,a7 as oe,a8 as ie,a9 as de,aa as O,ab as R,ac as ue,ad as _e,ae as G,af as Re}from"./index.8fe12b5a.js";var M,j;function Pe(n,a){return!(n===a||v.isValidElement(n)&&v.isValidElement(a)&&n.key!=null&&n.key===a.key)}var H={out:"out-in",in:"in-out"},z=function(a,t,e){return function(){var r;a.props[t]&&(r=a.props)[t].apply(r,arguments),e()}},Me=(M={},M[H.out]=function(n){var a=n.current,t=n.changeState;return v.cloneElement(a,{in:!1,onExited:z(a,"onExited",function(){t(_,null)})})},M[H.in]=function(n){var a=n.current,t=n.changeState,e=n.children;return[a,v.cloneElement(e,{in:!0,onEntered:z(e,"onEntered",function(){t(_)})})]},M),je=(j={},j[H.out]=function(n){var a=n.children,t=n.changeState;return v.cloneElement(a,{in:!0,onEntered:z(a,"onEntered",function(){t(L,v.cloneElement(a,{in:!0}))})})},j[H.in]=function(n){var a=n.current,t=n.children,e=n.changeState;return[v.cloneElement(a,{in:!1,onExited:z(a,"onExited",function(){e(L,v.cloneElement(t,{in:!0}))})}),v.cloneElement(t,{in:!0})]},j),Q=function(n){ge(a,n);function a(){for(var e,r=arguments.length,l=new Array(r),i=0;i<r;i++)l[i]=arguments[i];return e=n.call.apply(n,[this].concat(l))||this,e.state={status:L,current:null},e.appeared=!1,e.changeState=function(o,u){u===void 0&&(u=e.state.current),e.setState({status:o,current:u})},e}var t=a.prototype;return t.componentDidMount=function(){this.appeared=!0},a.getDerivedStateFromProps=function(r,l){return r.children==null?{current:null}:l.status===_&&r.mode===H.in?{status:_}:l.current&&Pe(l.current,r.children)?{status:se}:{current:v.cloneElement(r.children,{in:!0})}},t.render=function(){var r=this.props,l=r.children,i=r.mode,o=this.state,u=o.status,m=o.current,s={children:l,current:m,changeState:this.changeState,status:u},h;switch(u){case _:h=je[i](s);break;case se:h=Me[i](s);break;case L:h=m}return c(xe.Provider,{value:{isMounting:!this.appeared},children:h})},a}(v.Component);Q.propTypes={};Q.defaultProps={mode:H.out};const Le=Q;var X=globalThis&&globalThis.__assign||function(){return X=Object.assign||function(n){for(var a,t=1,e=arguments.length;t<e;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n},X.apply(this,arguments)},Ve=globalThis&&globalThis.__rest||function(n,a){var t={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&a.indexOf(e)<0&&(t[e]=n[e]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,e=Object.getOwnPropertySymbols(n);r<e.length;r++)a.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(n,e[r])&&(t[e[r]]=n[e[r]]);return t},ze=globalThis&&globalThis.__read||function(n,a){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var e=t.call(n),r,l=[],i;try{for(;(a===void 0||a-- >0)&&!(r=e.next()).done;)l.push(r.value)}catch(o){i={error:o}}finally{try{r&&!r.done&&(t=e.return)&&t.call(e)}finally{if(i)throw i.error}}return l},Ue={type:"circle"};function qe(n,a){var t,e=N.exports.useContext(Ce),r=e.getPrefixCls,l=e.size,i=e.componentConfig,o=e.rtl,u=Ee(n,Ue,i==null?void 0:i.Switch),m=u.className,s=u.children,h=u.style,$=h===void 0?{}:h,b=u.disabled,U=u.size,w=u.loading,A=u.onChange,f=u.type,p=u.checkedText,C=u.uncheckedText,y=u.checkedIcon,E=u.uncheckedIcon,D=Ve(u,["className","children","style","disabled","size","loading","onChange","type","checkedText","uncheckedText","checkedIcon","uncheckedIcon"]),g=r("switch"),q=U||l,ae=ze(N.exports.useState(u.defaultChecked),2),fe=ae[0],pe=ae[1],x="checked"in u?u.checked:fe,he=function(I){w||(u.onClick&&u.onClick(I),"checked"in u||pe(!x),A&&A(!x,I))},ve=Ne(g,q==="small"?g+"-"+q:void 0,(t={},t[g+"-type-"+f]=f,t[g+"-checked"]=x,t[g+"-loading"]=w,t[g+"-rtl"]=o,t),m),k=p,S=C;s&&we(s)?(k=s.find(function(I){return I.key==="open"}),S=s.find(function(I){return I.key==="close"})):s&&Fe(s)&&(s.key==="open"?k=s:s.key==="close"&&(S=s));var ye=be(D,["onChange","checked","error"]);return d("button",{...X({ref:a,role:"switch","aria-checked":!!x,tabIndex:w?-1:void 0},ye,{style:$,className:ve,disabled:b,onClick:he,type:"button"}),children:[d("div",{className:g+"-dot",children:[!w&&(y||E)&&c(Le,{children:c(re,{classNames:"fadeIn",timeout:200,children:c("span",{className:g+"-dot-icon",children:x?y:E})},x?"checked":"unchecked")}),w&&c("span",{className:g+"-dot-icon",children:c(ke,{})})]}),q!=="small"&&f!=="line"&&(k||S)&&d(Z,{children:[d("div",{className:g+"-text-holder",children:[k&&x&&k,S&&!x&&S]}),c(re,{in:x,classNames:"switchSlideText",timeout:200,children:d("div",{className:g+"-text",children:[k&&x&&k,S&&!x&&S]})})]})]})}var We=N.exports.forwardRef(qe),ee=We;ee.__BYTE_SWITCH=!0;ee.displayName="Switch";const me=ee,Ge="# --- NET_HELPER-START ---",Je=n=>n.filter(t=>t.open).map(t=>t.type==="system"?`${t.content}
${Ge}`:`
# --- ${t.name}  ---
${t.content}
`).join(`
`),Ze=function(n,a){let t=null;return(...e)=>{t&&clearTimeout(t),t=setTimeout(n.bind({},...e),a)}},Xe=async()=>await Y.send("fetchHosts"),Ye=async n=>await Y.send("saveHosts",n),Ke=async n=>await Y.send("updateRemoteHost",n,4e4);function Qe(n,a){const t=N.exports.useContext(le),e=t.prefixCls,r=e===void 0?"arco":e,l=n.spin,i=n.className,o={"aria-hidden":!0,focusable:!1,ref:a,...n,className:`${i?i+" ":""}${r}-icon ${r}-icon-cloud`};return l&&(o.className=`${o.className} ${r}-icon-loading`),delete o.spin,delete o.isIcon,c("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...o,children:c("path",{d:"M5 29a9 9 0 0 0 9 9h19c5.523 0 10-4.477 10-10 0-5.312-4.142-9.657-9.373-9.98C32.3 12.833 27.598 9 22 9c-6.606 0-11.965 5.338-12 11.935A9 9 0 0 0 5 29Z"})})}const ne=v.forwardRef(Qe);ne.defaultProps={isIcon:!0};ne.displayName="IconCloud";const en=ne;function nn(n,a){const t=N.exports.useContext(le),e=t.prefixCls,r=e===void 0?"arco":e,l=n.spin,i=n.className,o={"aria-hidden":!0,focusable:!1,ref:a,...n,className:`${i?i+" ":""}${r}-icon ${r}-icon-desktop`};return l&&(o.className=`${o.className} ${r}-icon-loading`),delete o.spin,delete o.isIcon,c("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...o,children:c("path",{d:"M24 32v8m0 0h-9m9 0h9M7 32h34a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v22a1 1 0 0 0 1 1Z"})})}const te=v.forwardRef(nn);te.defaultProps={isIcon:!0};te.displayName="IconDesktop";const tn=te,an=({className:n="",layout:a="horizontal"})=>c("span",{className:`base-line base-line__${a} ${n}`}),sn=n=>{const{type:a,mode:t,name:e,className:r="",onSwitch:l,onEdit:i,defaultValue:o,value:u,...m}=n;return d("div",{className:`flex flex-row items-center w-full p-4 group ${r}`,...m,children:[a==="local"?c(Se,{}):a==="remote"?c(en,{}):c(tn,{}),d("div",{className:"pl-2 w-[70%] flex items-center",children:[c("span",{children:e}),t==="readonly"&&c("span",{className:$e.readonly,children:"\u53EA\u8BFB"})]}),c("div",{className:`px-2 cursor-pointer invisible ${t==="edit"?"group-hover:visible":""}`,children:c(Ie,{onClick:s=>{s.stopPropagation(),i==null||i(e)}})}),c(me,{className:`${a==="system"?"invisible":""}`,checked:u,onChange:(s,h)=>{l==null||l(s),h.stopPropagation()}})]})},{Title:rn}=He,cn=({className:n="",data:a,current:t,onClick:e,onSwitch:r,onEdit:l})=>{var i;return d("div",{className:`${ce.container} ${n}`,children:[d(rn,{className:"flex flex-row items-center",children:[c(Te,{position:"right",content:"\u901A\u8FC7\u4FEE\u6539hosts\u7684\u65B9\u5F0F\u5E2E\u4F60\u5FEB\u901F\u4E0A\u7F51\uFF0C\u52A9\u529B\u89E3\u51B3\u83AB\u540D\u5176\u5999\u7684\u65E0\u6CD5\u8FDE\u63A5\u5185\u7F51",children:c("svg",{className:"icon mr-1 cursor-help",children:c("use",{xlinkHref:"#icon-m-hosts"})})}),c("span",{children:"\u9B54\u6CD5HOSTS"})]}),c(Be,{children:(i=a==null?void 0:a.map(o=>c(sn,{className:`cursor-pointer ${t===o.name?ce["row-current"]:""}`,onClick:()=>e==null?void 0:e(o),onSwitch:u=>r==null?void 0:r(o,Boolean(u)),onEdit:()=>l==null?void 0:l(o),value:o.open,type:o.type,name:o.name,mode:o.mode},o.name)))!=null?i:"empty"})]})},P=async(n,a)=>new Promise(async t=>{n||t(!1);try{const e=await Ye(n);a==null||a(e.data),t(e.data);return}catch(e){if(console.error("submitSave",e),(e==null?void 0:e.code)===403){B.error("\u6CA1\u6709\u5199\u5165Hosts\u6587\u4EF6\u7684\u6743\u9650");const r=async i=>{const o=document.getElementById("sudo").value;!o||(await window.storage.set("sudo",o),i.close(),setTimeout(()=>{t(P(n,a))},0))},l=Ae.confirm({title:"\u8BF7\u8F93\u5165\u4F60\u7684\u767B\u9646\u5BC6\u7801\uFF08sudo\u5BC6\u7801\uFF09",content:c(De,{id:"sudo",className:"flex",inputClassName:"py-2",autoFocus:!0,type:"password"}),onOk:()=>r(l)});return}t(!1)}}),{Option:F}=de,on=({className:n="",current:a,onChange:t})=>{var w,A;const e=K(),[r,l]=N.exports.useState(!1),[i,o]=N.exports.useState(!1),[u]=T.useForm(),{hosts:m,host:s}=V(f=>f.host),h=async(f,p)=>{var E;const C=(E=m==null?void 0:m.map(D=>D.name===f.name?{...D,open:p}:D))!=null?E:[],y=await P(C,()=>B.success("\u64CD\u4F5C\u6210\u529F"));y&&e(O(y))},$=async f=>{e(R(f)),l(!0)},b=async f=>{o(!0);try{const{data:p}=await Ke(f),C=await P(p,()=>B.success("\u64CD\u4F5C\u6210\u529F"));if(C){e(O(C));const y=C.find(E=>E.name===f.name);y&&e(R(y))}}catch(p){console.error("handleUpdateRemote",p),p==="request timeout"?B.error("\u8BF7\u6C42\u8D85\u65F6"):B.error(p==null?void 0:p.message)}o(!1)},U=async()=>{u.validate().then(async f=>{l(!1);const p={...s,...f},C=m==null?void 0:m.map(E=>E.name===(s==null?void 0:s.name)?p:E);if(JSON.stringify(m)===JSON.stringify(C))return;const y=await P(C,()=>B.success("\u64CD\u4F5C\u6210\u529F"));y&&(e(R(p)),e(O(y)))})};return N.exports.useEffect(()=>{async function f(){const p=await Xe();p.code===200&&(e(O(p.data)),t==null||t(p.data[0]))}f()},[]),d(Z,{children:[c(cn,{className:n,data:m,onSwitch:h,onEdit:$,onClick:f=>t==null?void 0:t(f),current:a}),c(Oe,{className:W.drawer,title:"\u7F16\u8F91Hosts",width:"calc(100vw - 240px - 2rem)",visible:r,onCancel:()=>l(!1),onOk:U,children:d(T,{layout:"vertical",className:`${W.form}`,form:u,initialValues:s!=null?s:{},validateMessages:{string:{match:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u94FE\u63A5"}},children:[c(T.Item,{label:"Host\u7C7B\u578B",field:"type",children:d("div",{className:"flex flex-row",children:[c(oe,{checked:(s==null?void 0:s.type)==="local",disabled:!0,children:"\u672C\u5730"}),c(oe,{className:"ml-4",checked:(s==null?void 0:s.type)==="remote",disabled:!0,children:"\u8FDC\u7A0B"})]})}),c(T.Item,{label:"\u540D\u79F0",field:"name",defaultValue:(w=s==null?void 0:s.name)!=null?w:"",rules:[{required:!0},{maxLength:10}],children:c(ie,{defaultValue:(A=s==null?void 0:s.name)!=null?A:""})}),(s==null?void 0:s.type)==="remote"&&d(Z,{children:[c(T.Item,{label:"URL",field:"url",required:!0,rules:[{match:/[a-zA-z]+:\/\/[^\s]*/}],children:c(ie,{})}),c(T.Item,{label:"\u81EA\u52A8\u66F4\u65B0",field:"autoUpdate",required:!0,children:d(de,{children:[c(F,{value:"never",children:"\u4ECE\u4E0D"}),c(F,{value:"1m",children:"1\u5206\u949F"}),c(F,{value:"5m",children:"5\u5206\u949F"}),c(F,{value:"15m",children:"15\u5206\u949F"}),c(F,{value:"30m",children:"30\u5206\u949F"}),c(F,{value:"1h",children:"1\u5C0F\u65F6"}),c(F,{value:"1d",children:"1\u5929"}),c(F,{value:"7d",children:"7\u5929"})]})}),d("div",{className:W.info,children:[d("span",{children:["\u6700\u540E\u66F4\u65B0\uFF1A",s!=null&&s.updateTime?new Date(s.updateTime).format("yyyy-MM-dd hh:mm:ss"):"\u4ECE\u672A"]}),c("span",{className:`ml-2 font-bold ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,onClick:()=>{b(s)},children:"\u624B\u52A8\u66F4\u65B0"})]})]})]})},s==null?void 0:s.name)]})},J=[{name:"\u81EA\u52A8\u66F4\u65B0",field:"autoUpdate"},{name:"\u6C38\u4E0D\u65AD\u7F51",field:"neverOffline"},{name:"\u5F00\u673A\u81EA\u542F",field:"autoStart"},{name:"\u81EA\u52A8\u4E3B\u9898",field:"autoTheme"},{name:"\u901A\u77E5\u670D\u52A1",field:"noticeService"}],un=({className:n=""})=>{const a=K(),{config:t}=V(r=>r.base),e=N.exports.useMemo(()=>t?J.map(r=>({...r,value:t[r.field]})):J.map(r=>({...r,value:!1})),[J,t]);return c("div",{className:`${n}`,children:e.map((r,l)=>d("label",{className:`flex flex-row items-center justify-between mb-1 px-4 py-2 ${ue.row}`,children:[c("div",{className:`${ue.name}`,children:r.name}),c(me,{checked:r.value,onChange:i=>{a(_e({[r.field]:i}))}})]},l))})},dn=()=>{var u,m;const n=K(),{theme:a}=V(s=>s.base),{hosts:t,host:e}=V(s=>s.host),r=s=>{n(R(s!=null?s:null))},l=Ze(async s=>{const h=t.map(b=>b.name===(e==null?void 0:e.name)?{...b,content:s!=null?s:""}:b),$=await P(h);$&&(n(O($)),n(R(e?{...e,content:s!=null?s:""}:null)))},500),i=async s=>{(e==null?void 0:e.type)!=="system"&&l(s)},o=(e==null?void 0:e.type)==="system"?Je(t):(u=e==null?void 0:e.content)!=null?u:"";return d("div",{className:`main ${G.container}`,children:[d("div",{className:`w-[240px] flex flex-col pr-4 ${G.left}`,children:[c(on,{className:"mb-4",onChange:r,current:(m=e==null?void 0:e.name)!=null?m:null}),c(an,{className:"mb-4 mt-2"}),c(un,{className:"w-[240px]"})]}),c("div",{className:`relative flex flex-col flex-grow rounded-lg overflow-hidden ${(e==null?void 0:e.mode)==="edit"?"":G["not-allow-edit"]}`,children:c(Re,{height:"100%",theme:a==="dark"?"vs-dark":"vs-light",defaultValue:String(o),onChange:i},e==null?void 0:e.name)})]})};export{dn as default};
