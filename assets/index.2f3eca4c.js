import{a as M,r as h,R as ae,I as ue,j as t,b as r,T as oe,B as ie,s as G,c as ce,d as le,F as j,e as re,M as de,f as fe,g as me,h as he,_ as X,i as Y,u as ee,k as pe,l as we,m as xe,n as ge,o as Fe,p as K,q as T,t as Q,v as Ee}from"./index.58c1318c.js";import{S as Ne}from"./index.de7226cd.js";import{l as se}from"./login.79bc3046.js";async function ve(){return M.send("getNetInfo")}const Be=async e=>{var n;const a=await M.send("fetchPlatformList",{cookie:e}),u=(n=await window.storage.get("nameStore"))!=null?n:{};return a.data.list.forEach(i=>{const l=u[i.id],m=u[i.ip];if(!(!l&&!m)){if(l===m){i.name=l;return}m&&(i.name=m)}}),a},te=async(e,a)=>M.send("offlinePlatform",{link:e,cookie:a}),ye=async({username:e,password:a})=>M.send("connect",{username:e,password:a}),Ce=e=>{const[a,u]=h.exports.useState(0),[n,i]=h.exports.useState(0),[l,m]=h.exports.useState([]),[o,x]=h.exports.useState(0),[d,y]=h.exports.useState(0),[v,B]=h.exports.useState(0);return h.exports.useEffect(()=>{if(!e)return;const C=setInterval(()=>{const F=window.navigator.connection;F&&(y(F.downlink),B(F.rtt));const E=new Image,c=new Date().getTime();E.src=`https://www.baidu.com/favicon.ico?d=${c}`,E.onload=()=>{const p=new Date().getTime()-c;if((n+1)%5===0){const w=Math.max(p,...l),A=Math.min(p,...l);x(w-A),m([])}else m(w=>[...w,p]);i(n+1),u(p)},E.onerror=f=>{console.error("useSpeed:error",f)}},5e3);return()=>{clearInterval(C)}},[n,l,e]),[a,o,d,v]};function Ae(e,a){const u=h.exports.useContext(ue),n=u.prefixCls,i=n===void 0?"arco":n,l=e.spin,m=e.className,o={"aria-hidden":!0,focusable:!1,ref:a,...e,className:`${m?m+" ":""}${i}-icon ${i}-icon-sync`};return l&&(o.className=`${o.className} ${i}-icon-loading`),delete o.spin,delete o.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...o,children:t("path",{d:"M11.98 11.703c-6.64 6.64-6.64 17.403 0 24.042a16.922 16.922 0 0 0 8.942 4.7M34.603 37.156l1.414-1.415c6.64-6.639 6.64-17.402 0-24.041A16.922 16.922 0 0 0 27.075 7M14.81 11.982l-1.414-1.414-1.414-1.414h2.829v2.828ZM33.192 36.02l1.414 1.414 1.414 1.415h-2.828V36.02Z"})})}const _=ae.forwardRef(Ae);_.defaultProps={isIcon:!0};_.displayName="IconSync";const Se=_,ke=({ip:e,name:a,startTime:u,endTime:n,beforeNode:i,afterNode:l,className:m="",id:o,onChange:x,current:d})=>{const y=new Date(u).getTime(),B=(n?new Date(n):new Date).getTime()-y,C=Math.floor(B/(24*3600*1e3)),F=B%(24*3600*1e3),E=Math.floor(F/(3600*1e3)),c=F%(3600*1e3),f=Math.floor(c/(60*1e3)),p=C>0?`${C}d ${E}h ${f}min`:`${E}h ${f}min`;return r("div",{className:`flex flex-row w-full py-[10px] px-[18px] justify-between items-center ${m}`,children:[i,r("span",{className:"w-[135px]",children:[d!==void 0&&t(oe,{content:"\u672C\u673A",children:t("span",{className:`mr-2 transition-all cursor-default ${d?"visible":"invisible"}`,children:"\u25B6"})}),e]}),t(ie,{className:`mr-[15px] overflow-hidden text-clip ${G["ip-row-input"]}`,defaultValue:a!=null?a:"",placeholder:"\u8F93\u5165\u8BBE\u5907\u540D",onFinished:w=>x==null?void 0:x({val:w,id:o,ip:e})}),t("span",{className:"w-[175px] select-text",children:u}),t("span",{className:`w-[70px] ${G["ip-row-status"]}`,"data-status":!n,children:n?"\u79BB\u7EBF":"\u5728\u7EBF"}),t("span",{className:"w-[144px]",children:p}),l]})},{Title:De}=X,Ie=({platformList:e,currentIP:a,onOffline:u,onNameChange:n,onFlush:i})=>{const l=h.exports.useMemo(()=>e===null?t("div",{className:"flex justify-center items-center w-full h-[140px]",children:t(ce,{spin:!0})}):e.length===0?t("div",{className:"flex justify-center items-center w-full h-[140px]",children:t(le,{})}):e.map(d=>t(ke,{current:d.ip===a,afterNode:r(j,{children:[t(re,{className:"ml-6 whitespace-nowrap",theme:"danger",onClick:()=>u(d),disabled:d.endTime!==null,children:"\u4E0B\u7EBF"}),t(de,{triggerClassName:"ml-3",infoList:[d.id,d.nasIP]})]}),onChange:n,...d},d.id)),[e]),[m,o]=h.exports.useState(!1);return r(j,{children:[r(De,{className:"mb-2 ml-1 flex flex-row items-center",children:[t(fe,{position:"right",content:"\u57FA\u4E8EIP\u548C\u4F1A\u8BDDID\u662F\u5426\u76F8\u540C\u5224\u65AD\u662F\u5426\u4E3A\u540C\u4E00\u8BBE\u5907\uFF0C\u6682\u65F6\u65E0\u6CD5\u89C4\u907FIP\u53D8\u52A8\u5BFC\u81F4\u81EA\u5B9A\u4E49\u8BBE\u5907\u540D\u79F0\u4E22\u5931\u7684\u60C5\u51B5",children:t("svg",{className:"icon mr-1 cursor-help",children:t("use",{xlinkHref:"#icon-xiangmu"})})}),t("span",{children:"\u8BBE\u5907\u5217\u8868"}),t("div",{onClick:()=>{const d=setTimeout(()=>{o(!0)},200);i().finally(()=>{clearTimeout(d),o(!1)})},children:t(Se,{className:"ml-2 cursor-pointer",spin:m})})]}),t(me,{className:`min-h-[145px] ${he["platform-list"]}`,autoHeight:!0,children:l})]})},$=({name:e,value:a,type:u})=>r("div",{className:"flex flex-row items-center justify-between",children:[r("div",{className:"flex flex-row items-center font-bold",children:[t(Ne,{className:"mr-1",type:u}),t("span",{className:"mr-1 mt-[1px] text-xs select-text",children:e})]}),t("span",{className:"opacity-80 hover:opacity-100 transition-opacity select-text",children:a})]}),$e=({netInfo:e,className:a=""})=>{var u,n;return r(Y,{title:"\u7F51\u7EDC\u4FE1\u606F",className:`${a}`,children:[t($,{name:"IP",value:e.ip.value,type:e.ip.type}),t($,{name:"DNS",value:(u=e.dns.value[0])!=null?u:"",type:e.dns.type}),e.dns.value[1]&&t($,{name:"",value:(n=e.dns.value[1])!=null?n:"",type:"normal"}),e.wifiName&&t($,{name:"WIFI",value:e.wifiName.value,type:e.wifiName.type}),t($,{name:"DHCP",value:e.dhcp.value,type:e.dhcp.type})]})},{Title:Pe}=X,be=()=>{var a,u;const{currentDuty:e}=ee(n=>n.center);return t("div",{className:"flex flex-col mt-4",children:!e||e==="loading"?t("div",{className:"w-full flex flex-col items-center h-[200px] justify-center",children:t(pe,{size:"large"})}):r(j,{children:[r(Pe,{className:"ml-3",children:["\u5F53\u524D\u503C\u73ED",e!=null&&e.name?`\uFF1A${e==null?void 0:e.name}`:""]}),t(Y,{className:"mt-1 h-full",title:"",itemClassName:"w-full h-full mt-0",listClassName:"w-full h-full",children:r("div",{className:"flex flex-col items-center justify-evenly max-h-full h-full",children:[t("p",{children:e==null?void 0:e.desc}),t(we,{allowHalf:!0,readonly:!0,value:(a=e==null?void 0:e.rate)!=null?a:0}),t("img",{className:"object-cover rounded-[9px] mt-3 select-none overflow-hidden",width:180,height:180,src:(u=e==null?void 0:e.avatarUrl)!=null?u:""})]})})]})})},Me="/sztunethelper/assets/connecting.0abcdb2e.mp4",Te="/sztunethelper/assets/logging.63b4645c.mp4",je="/sztunethelper/assets/no-net.83c5971a.svg",_e=async(e,a)=>{var n,i;const u=await se(a);await te(e,(i=(n=u.data)==null?void 0:n.cookies)!=null?i:"")},We=()=>{const e=xe(),a=ge(),u=Fe(),[n,i]=h.exports.useState([]),[l,m]=h.exports.useState("offline"),o=c=>{window.storage.set("netStatus",c),m(c)},x=ee(c=>c.netInfo),[d,y]=Ce(l==="success"),v=async c=>{var L,H,W,z,O,U,V,P,Z,q;const f=await window.storage.get("username"),p=await window.storage.get("password");if(console.info("login:username",f),!f||!p){o("offline"),a.push("/login");return}const w=async()=>{if(console.info("init#getCookie:start"),sessionStorage.getItem("cookie")&&c!=="refresh"){o("connect");return}const g=await se({username:f,password:p});g.code===200?(sessionStorage.setItem("cookie",g.data.cookies),o("connect")):o("offline"),console.info("init#getCookie:end")},A=async()=>{try{const s=await ve();if(s.code===200)return e(Ee(s.data)),s.data}catch(s){console.error(s)}return null},k=async(s,g)=>{if(s===null)return;i(null);const N=await Be(s);i(N.data.list);const I=N.data.list.find(b=>b.ip===g);!I||await window.storage.set("currentPlatform",I)},D=async(s,g)=>{var I,b,J;const N=await window.storage.get("currentPlatform");if(N&&N.user!==f){const S=(I=await window.storage.get("accountStore"))!=null?I:[];await _e(N.link,{username:N.user,password:(J=(b=S.find(ne=>ne.username===N.user))==null?void 0:b.password)!=null?J:""})}try{const S=await ye({username:f,password:p});S.code===200?(o("success"),S.msg==="login success"&&await k(s,g)):o("offline")}catch(S){console.error(S)}},R=()=>{T.confirm({title:"\u8054\u7F51\u63D0\u793A",content:"\u522B\u6025\uFF01\u5173\u6389\u7CFB\u7EDF\u5F39\u51FA\u7684\u4E0A\u7F51\u8BA4\u8BC1\u7A97\u53E3\uFF0C\u70B9\u51FB\u786E\u8BA4\u5373\u53EF\uFF01",onOk:()=>{a.push("/index?refresh")},hideCancel:!0}),o("offline")};try{const s=await A();if(((L=s==null?void 0:s.wifiName)==null?void 0:L.type)==="fail")throw new Error("\u672A\u8FDE\u63A5\u6307\u5B9AWIFI");(H=s==null?void 0:s.proxy)!=null&&H.value&&T.confirm({title:"\u68C0\u6D4B\u5230\u60A8\u5F00\u542F\u4E86\u4EE3\u7406",content:r("div",{children:[t("p",{children:"\u5982\u60A8\u5F53\u524D\u6253\u5F00\u7F51\u9875\u63D0\u793A\u3010\u4EE3\u7406\u670D\u52A1\u5668\u53EF\u80FD\u6709\u95EE\u9898\u3011"}),t("p",{className:"mt-3",children:"\u8BE5\u95EE\u9898\u7684\u539F\u56E0\u662F\u60A8\u7684\u4EE3\u7406\u670D\u52A1\u5668\u4E0D\u6B63\u5E38\uFF0C\u8BF7\u5173\u95ED\u4EE3\u7406\u540E\u91CD\u8BD5"})]}),hideCancel:!0}),await w();const g=sessionStorage.getItem("cookie");await k(g,(W=s==null?void 0:s.ip)==null?void 0:W.value),D(g,(z=s==null?void 0:s.ip)==null?void 0:z.value)}catch(s){if(console.error("error:init",s),s.message==="\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"){Q.error({content:"\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"}),o("offline");return}if((s==null?void 0:s.code)===502&&((O=s==null?void 0:s.data)==null?void 0:O.code)===-1&&((U=s==null?void 0:s.data)==null?void 0:U.cookies)===null){Q.error({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8D26\u53F7\u5BC6\u7801\u662F\u5426\u6B63\u786E"}),o("offline"),a.push("/login");return}if((s==null?void 0:s.code)===-1&&((Z=(P=(V=s==null?void 0:s.data)==null?void 0:V.message)==null?void 0:P.includes)==null?void 0:Z.call(P,"connect ENETUNREACH 47.98.217.39"))){R();return}if((s==null?void 0:s.code)===502&&((q=s==null?void 0:s.data)==null?void 0:q.code)===-10056){R();return}}},B=h.exports.useCallback(()=>{l==="offline"&&(o("logging"),v())},[l]),C=c=>{T.confirm({title:"\u786E\u8BA4\u4E0B\u7EBF",content:`\u786E\u8BA4\u4E0B\u7EBF${c.ip}\u5417\uFF1F`,onOk:async()=>{var f,p;te(c.link,(f=sessionStorage.getItem("cookie"))!=null?f:""),c.ip===x.ip.value&&o("offline"),i((p=n==null?void 0:n.map(w=>w.link===c.link?{...w,endTime:new Date().format("yyyy-MM-dd hh:mm:ss")}:w))!=null?p:null)}})},F=async({val:c,id:f,ip:p})=>{var A,k;const w=(A=await window.storage.get("nameStore"))!=null?A:{};i((k=n==null?void 0:n.map(D=>D.id===f?{...D,name:c}:D))!=null?k:null),w[f]=c,w[p]=c,await window.storage.set("nameStore",w)},E=h.exports.useMemo(()=>{const c=(()=>{switch(l){case"offline":return t("img",{src:je,width:270});case"logging":return t("video",{autoPlay:!0,loop:!0,src:Te,width:360,className:"mix-blend-multiply",preload:"auto"});case"connect":return t("video",{autoPlay:!0,loop:!0,src:Me,width:360,className:"mix-blend-color-burn",preload:"auto"});default:return r("div",{className:"text-3xl",children:[r("div",{children:["\u5EF6\u8FDF\uFF1A",d,"ms"]}),r("div",{children:["\u6296\u52A8\uFF1A",y,"ms"]})]})}})();return t("div",{className:`w-full min-h-[380px] h-full mt-6 rounded-[15px] ${K["main__background-card"]} ${K[`main__background-card__${l}`]}`,onClick:B,children:t("div",{className:"w-full h-full flex items-center justify-center text-[45px]",children:c})})},[l,B,d,y]);return h.exports.useEffect(()=>{v()},[]),h.exports.useEffect(()=>{u.search==="?refresh"&&v("refresh")},[u]),t("div",{className:"main",children:r("div",{className:"flex flex-grow-0 flex-shrink-0 w-full h-full",children:[r("div",{className:"flex flex-col h-full max-w-[220px]",children:[t($e,{className:"min-w-[220px]",netInfo:x}),t(be,{})]}),r("div",{className:"flex flex-col ml-6 w-full h-full",children:[t(Ie,{platformList:n,currentIP:x.ip.value,onOffline:C,onNameChange:F,onFlush:v}),E]})]})})};export{We as default};
