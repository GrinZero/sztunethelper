import{j as u,A as c,b as N,i as b,C as B,m as $,n as v,r as m,u as D,L as E,v as f,D as j,E as F,t as L,G as M}from"./index.f5019430.js";import{l as P}from"./login.584cd434.js";const R=({className:n="",onChoose:r,onDelete:a,current:d,data:o})=>u("div",{className:`${c.container} ${n}`,children:o.map(t=>N(b,{className:`cursor-pointer mr-3 min-w-[160px] flex-shrink-0 overflow-hidden ${c.base} ${d===t.username?c.current:""}`,title:t.username,itemClassName:"flex-grow",listClassName:"flex-grow",titleClassName:c.title,onClick:()=>r==null?void 0:r(t),border:!1,children:[u("div",{className:"w-full flex-grow h-full rounded-lg",children:t.packageData}),u("div",{className:`absolute bottom-4 -translate-x-1/2 left-1/2 hidden items-center justify-center ${c["icon-close"]}`,onClick:l=>{l.stopPropagation(),a==null||a(t)},children:u(B,{})})]},t.username))}),H=()=>{const n=$(),r=v(),a=m.exports.useRef(null),[d,o]=m.exports.useState("");m.exports.useEffect(()=>{(async()=>{const i=await window.storage.get("username");o(i||"")})()},[]);const{accountStore:t,currentAccount:l}=D(s=>s.account),[S,p]=m.exports.useState("normal"),C=async s=>{var i,h,g,w,x;try{p("loading");const e=await P(s);if(e.code!==200)throw e;f.success("\u767B\u9646\u6210\u529F"),t.find(A=>A.username===s.username)||n(j({...s,packageData:String(e.data.data)})),n(F(s)),setTimeout(()=>{r.push("/index?refresh")},0)}catch(e){(e==null?void 0:e.code)===502&&((i=e==null?void 0:e.data)==null?void 0:i.code)===-1&&((h=e==null?void 0:e.data)==null?void 0:h.cookies)===null?f.error("\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8D26\u53F7\u5BC6\u7801\u662F\u5426\u6B63\u786E"):f.error(String((x=(w=(g=e==null?void 0:e.data)==null?void 0:g.message)!=null?w:e==null?void 0:e.code)!=null?x:e))}finally{p("normal")}},k=s=>{!a.current||(n(F(s)),o(s.username),a.current.password&&(a.current.password.value=s.password),a.current.username&&(a.current.username.value=s.username))},y=s=>{L.confirm({title:"\u5220\u9664\u63D0\u793A",content:`\u786E\u8BA4\u5220\u9664${s.username}\u5417\uFF1F`,onOk:()=>{n(M(s))}})};return N("div",{className:"main flex-col items-center",children:[u(E,{className:"w-[60%] mt-16 flex-shrink-0",onSubmit:C,status:S,defaultUserName:l.username,defaultPassword:l.password,ref:a}),t.length>0&&u(R,{onChoose:k,onDelete:y,current:d,data:t,className:"mt-12 w-[85%] min-h-[180px]"})]})};export{H as default};
