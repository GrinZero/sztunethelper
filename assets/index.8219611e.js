import{R as x,G as Ee,H as V,J as H,K as re,j as s,N as Ne,r as k,O as we,Q as Fe,U as ke,V as be,W as ge,X as Se,b as p,Y as se,c as $e,F as J,a as X,I as de,Z as Ce,$ as Ie,a0 as Te,a1 as ce,f as Be,g as Ae,_ as De,t as A,q as Oe,a2 as _e,m as Y,a3 as B,u as z,a4 as Re,a5 as K,a6 as ue,a7 as ie,a8 as me,a9 as R,aa as M,ab as le,ac as He,ad as G,ae as Me}from"./index.58c1318c.js";var j,L;function Pe(n,a){return!(n===a||x.isValidElement(n)&&x.isValidElement(a)&&n.key!=null&&n.key===a.key)}var D={out:"out-in",in:"in-out"},U=function(a,t,e){return function(){var r;a.props[t]&&(r=a.props)[t].apply(r,arguments),e()}},je=(j={},j[D.out]=function(n){var a=n.current,t=n.changeState;return x.cloneElement(a,{in:!1,onExited:U(a,"onExited",function(){t(H,null)})})},j[D.in]=function(n){var a=n.current,t=n.changeState,e=n.children;return[a,x.cloneElement(e,{in:!0,onEntered:U(e,"onEntered",function(){t(H)})})]},j),Le=(L={},L[D.out]=function(n){var a=n.children,t=n.changeState;return x.cloneElement(a,{in:!0,onEntered:U(a,"onEntered",function(){t(V,x.cloneElement(a,{in:!0}))})})},L[D.in]=function(n){var a=n.current,t=n.children,e=n.changeState;return[x.cloneElement(a,{in:!1,onExited:U(a,"onExited",function(){e(V,x.cloneElement(t,{in:!0}))})}),x.cloneElement(t,{in:!0})]},L),Q=function(n){Ee(a,n);function a(){for(var e,r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return e=n.call.apply(n,[this].concat(o))||this,e.state={status:V,current:null},e.appeared=!1,e.changeState=function(i,l){l===void 0&&(l=e.state.current),e.setState({status:i,current:l})},e}var t=a.prototype;return t.componentDidMount=function(){this.appeared=!0},a.getDerivedStateFromProps=function(r,o){return r.children==null?{current:null}:o.status===H&&r.mode===D.in?{status:H}:o.current&&Pe(o.current,r.children)?{status:re}:{current:x.cloneElement(r.children,{in:!0})}},t.render=function(){var r=this.props,o=r.children,u=r.mode,i=this.state,l=i.status,N=i.current,d={children:o,current:N,changeState:this.changeState,status:l},c;switch(l){case H:c=Le[u](d);break;case re:c=je[u](d);break;case V:c=N}return s(Ne.Provider,{value:{isMounting:!this.appeared},children:c})},a}(x.Component);Q.propTypes={};Q.defaultProps={mode:D.out};const Ve=Q;var Z=globalThis&&globalThis.__assign||function(){return Z=Object.assign||function(n){for(var a,t=1,e=arguments.length;t<e;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n},Z.apply(this,arguments)},ze=globalThis&&globalThis.__rest||function(n,a){var t={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&a.indexOf(e)<0&&(t[e]=n[e]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,e=Object.getOwnPropertySymbols(n);r<e.length;r++)a.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(n,e[r])&&(t[e[r]]=n[e[r]]);return t},Ue=globalThis&&globalThis.__read||function(n,a){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var e=t.call(n),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=e.next()).done;)o.push(r.value)}catch(i){u={error:i}}finally{try{r&&!r.done&&(t=e.return)&&t.call(e)}finally{if(u)throw u.error}}return o},qe={type:"circle"};function Ke(n,a){var t,e=k.exports.useContext(we),r=e.getPrefixCls,o=e.size,u=e.componentConfig,i=e.rtl,l=Fe(n,qe,u==null?void 0:u.Switch),N=l.className,d=l.children,c=l.style,m=c===void 0?{}:c,O=l.disabled,C=l.size,w=l.loading,_=l.onChange,I=l.type,h=l.checkedText,f=l.uncheckedText,E=l.checkedIcon,v=l.uncheckedIcon,b=ze(l,["className","children","style","disabled","size","loading","onChange","type","checkedText","uncheckedText","checkedIcon","uncheckedIcon"]),y=r("switch"),q=C||o,ae=Ue(k.exports.useState(l.defaultChecked),2),pe=ae[0],he=ae[1],F="checked"in l?l.checked:pe,ye=function(T){w||(l.onClick&&l.onClick(T),"checked"in l||he(!F),_&&_(!F,T))},ve=ke(y,q==="small"?y+"-"+q:void 0,(t={},t[y+"-type-"+I]=I,t[y+"-checked"]=F,t[y+"-loading"]=w,t[y+"-rtl"]=i,t),N),S=h,$=f;d&&be(d)?(S=d.find(function(T){return T.key==="open"}),$=d.find(function(T){return T.key==="close"})):d&&ge(d)&&(d.key==="open"?S=d:d.key==="close"&&($=d));var xe=Se(b,["onChange","checked","error"]);return p("button",{...Z({ref:a,role:"switch","aria-checked":!!F,tabIndex:w?-1:void 0},xe,{style:m,className:ve,disabled:O,onClick:ye,type:"button"}),children:[p("div",{className:y+"-dot",children:[!w&&(E||v)&&s(Ve,{children:s(se,{classNames:"fadeIn",timeout:200,children:s("span",{className:y+"-dot-icon",children:F?E:v})},F?"checked":"unchecked")}),w&&s("span",{className:y+"-dot-icon",children:s($e,{})})]}),q!=="small"&&I!=="line"&&(S||$)&&p(J,{children:[p("div",{className:y+"-text-holder",children:[S&&F&&S,$&&!F&&$]}),s(se,{in:F,classNames:"switchSlideText",timeout:200,children:p("div",{className:y+"-text",children:[S&&F&&S,$&&!F&&$]})})]})]})}var Ge=k.exports.forwardRef(Ke),ee=Ge;ee.__BYTE_SWITCH=!0;ee.displayName="Switch";const fe=ee,We="# --- NET_HELPER-START ---",Je=n=>n.filter(t=>t.open).map(t=>t.type==="system"?`${t.content}
${We}`:`
# --- ${t.name}  ---
${t.content}
`).join(`
`),Ze=function(n,a){let t=null;return(...e)=>{t&&clearTimeout(t),t=setTimeout(n.bind({},...e),a)}},Xe=async()=>await X.send("fetchHosts"),Ye=async n=>await X.send("saveHosts",n),Qe=async n=>await X.send("updateRemoteHost",n,4e4),oe=()=>Math.random().toString(36).slice(2),et=()=>{const[n,a]=k.exports.useState(oe());return[n,()=>{a(oe())}]};function tt(n,a){const t=k.exports.useContext(de),e=t.prefixCls,r=e===void 0?"arco":e,o=n.spin,u=n.className,i={"aria-hidden":!0,focusable:!1,ref:a,...n,className:`${u?u+" ":""}${r}-icon ${r}-icon-cloud`};return o&&(i.className=`${i.className} ${r}-icon-loading`),delete i.spin,delete i.isIcon,s("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...i,children:s("path",{d:"M5 29a9 9 0 0 0 9 9h19c5.523 0 10-4.477 10-10 0-5.312-4.142-9.657-9.373-9.98C32.3 12.833 27.598 9 22 9c-6.606 0-11.965 5.338-12 11.935A9 9 0 0 0 5 29Z"})})}const te=x.forwardRef(tt);te.defaultProps={isIcon:!0};te.displayName="IconCloud";const nt=te;function at(n,a){const t=k.exports.useContext(de),e=t.prefixCls,r=e===void 0?"arco":e,o=n.spin,u=n.className,i={"aria-hidden":!0,focusable:!1,ref:a,...n,className:`${u?u+" ":""}${r}-icon ${r}-icon-desktop`};return o&&(i.className=`${i.className} ${r}-icon-loading`),delete i.spin,delete i.isIcon,s("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...i,children:s("path",{d:"M24 32v8m0 0h-9m9 0h9M7 32h34a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v22a1 1 0 0 0 1 1Z"})})}const ne=x.forwardRef(at);ne.defaultProps={isIcon:!0};ne.displayName="IconDesktop";const rt=ne,st=({className:n="",layout:a="horizontal"})=>s("span",{className:`base-line base-line__${a} ${n}`}),ct=n=>{const{type:a,mode:t,name:e,className:r="",onSwitch:o,onEdit:u,defaultValue:i,value:l,...N}=n;return p("div",{className:`flex flex-row items-center w-full p-4 group ${r}`,...N,children:[a==="local"?s(Ce,{}):a==="remote"?s(nt,{}):s(rt,{}),p("div",{className:"pl-2 w-[70%] flex items-center",children:[s("span",{children:e}),t==="readonly"&&s("span",{className:Ie.readonly,children:"\u53EA\u8BFB"})]}),s("div",{className:`px-2 cursor-pointer invisible ${t==="edit"?"group-hover:visible":""}`,children:s(Te,{onClick:d=>{d.stopPropagation(),u==null||u(e)}})}),s(fe,{className:`${a==="system"?"invisible":""}`,checked:l,onChange:(d,c)=>{o==null||o(d),c.stopPropagation()}})]})},{Title:ut}=De,it=({className:n="",data:a,current:t,onClick:e,onSwitch:r,onEdit:o})=>{var u;return p("div",{className:`${ce.container} ${n}`,children:[p(ut,{className:"flex flex-row items-center",children:[s(Be,{position:"right",content:"\u901A\u8FC7\u4FEE\u6539hosts\u7684\u65B9\u5F0F\u5E2E\u4F60\u5FEB\u901F\u4E0A\u7F51\uFF0C\u52A9\u529B\u89E3\u51B3\u83AB\u540D\u5176\u5999\u7684\u65E0\u6CD5\u8FDE\u63A5\u5185\u7F51",children:s("svg",{className:"icon mr-1 cursor-help",children:s("use",{xlinkHref:"#icon-m-hosts"})})}),s("span",{children:"\u9B54\u6CD5HOSTS"})]}),s(Ae,{children:(u=a==null?void 0:a.map(i=>s(ct,{className:`cursor-pointer ${t===i.name?ce["row-current"]:""}`,onClick:()=>e==null?void 0:e(i),onSwitch:l=>r==null?void 0:r(i,Boolean(l)),onEdit:()=>o==null?void 0:o(i),value:i.open,type:i.type,name:i.name,mode:i.mode},i.name)))!=null?u:"empty"})]})},P=async(n,a)=>new Promise(async t=>{n||t(!1);try{const e=await Ye(n);a==null||a(e.data),t(e.data);return}catch(e){if(console.error("submitSave",e),(e==null?void 0:e.code)===403){A.error("\u6CA1\u6709\u5199\u5165Hosts\u6587\u4EF6\u7684\u6743\u9650");const r=async u=>{const i=document.getElementById("sudo").value;!i||(await window.storage.set("sudo",i),u.close(),setTimeout(()=>{t(P(n,a))},0))},o=Oe.confirm({title:"\u8BF7\u8F93\u5165\u4F60\u7684\u767B\u9646\u5BC6\u7801\uFF08sudo\u5BC6\u7801\uFF09",content:s(_e,{id:"sudo",className:"flex",inputClassName:"py-2",autoFocus:!0,type:"password"}),onOk:()=>r(o)});return}t(!1)}}),{Option:g}=me,lt=({className:n="",current:a,onChange:t,onHostsChange:e})=>{var _,I;const r=Y(),[o,u]=k.exports.useState(!1),[i,l]=k.exports.useState(!1),[N]=B.useForm(),{hosts:d,host:c}=z(h=>h.host),m=async(h,f)=>{var b;const E=(b=d==null?void 0:d.map(y=>y.name===h.name?{...y,open:f}:y))!=null?b:[],v=await P(E,()=>A.success("\u64CD\u4F5C\u6210\u529F"));v&&(r(R(v)),e==null||e(v))},O=async h=>{r(M(h)),t==null||t(h),u(!0)},C=async h=>{l(!0);try{const{data:f}=await Qe(h),E=await P(f,()=>A.success("\u64CD\u4F5C\u6210\u529F"));if(E){r(R(E)),e==null||e(E);const v=E.find(b=>b.name===h.name);v&&(r(M(v)),t==null||t(v))}}catch(f){console.error("handleUpdateRemote",f),f==="request timeout"?A.error("\u8BF7\u6C42\u8D85\u65F6"):A.error(f==null?void 0:f.message)}l(!1)},w=async()=>{N.validate().then(async h=>{u(!1);const f={...c,...h},E=d==null?void 0:d.map(b=>b.name===(c==null?void 0:c.name)?f:b);if(JSON.stringify(d)===JSON.stringify(E))return;const v=await P(E,()=>A.success("\u64CD\u4F5C\u6210\u529F"));v&&(r(M(f)),r(R(v)),e==null||e(v),t==null||t(f))})};return k.exports.useEffect(()=>{async function h(){const f=await Xe();f.code===200&&(r(R(f.data)),t==null||t(f.data[0]))}h()},[]),p(J,{children:[s(it,{className:n,data:d,onSwitch:m,onEdit:O,onClick:h=>t==null?void 0:t(h),current:a}),s(Re,{className:K.drawer,title:"\u7F16\u8F91Hosts",width:"calc(100vw - 240px - 2rem)",visible:o,onCancel:()=>u(!1),onOk:w,children:p(B,{layout:"vertical",className:`${K.form}`,form:N,initialValues:c!=null?c:{},validateMessages:{string:{match:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u94FE\u63A5"}},children:[s(B.Item,{label:"Host\u7C7B\u578B",field:"type",children:p("div",{className:"flex flex-row",children:[s(ue,{checked:(c==null?void 0:c.type)==="local",disabled:!0,children:"\u672C\u5730"}),s(ue,{className:"ml-4",checked:(c==null?void 0:c.type)==="remote",disabled:!0,children:"\u8FDC\u7A0B"})]})}),s(B.Item,{label:"\u540D\u79F0",field:"name",defaultValue:(_=c==null?void 0:c.name)!=null?_:"",rules:[{required:!0},{maxLength:10}],children:s(ie,{defaultValue:(I=c==null?void 0:c.name)!=null?I:""})}),(c==null?void 0:c.type)==="remote"&&p(J,{children:[s(B.Item,{label:"URL",field:"url",required:!0,rules:[{match:/[a-zA-z]+:\/\/[^\s]*/}],children:s(ie,{})}),s(B.Item,{label:"\u81EA\u52A8\u66F4\u65B0",field:"autoUpdate",required:!0,children:p(me,{children:[s(g,{value:"never",children:"\u4ECE\u4E0D"}),s(g,{value:"1m",children:"1\u5206\u949F"}),s(g,{value:"5m",children:"5\u5206\u949F"}),s(g,{value:"15m",children:"15\u5206\u949F"}),s(g,{value:"30m",children:"30\u5206\u949F"}),s(g,{value:"1h",children:"1\u5C0F\u65F6"}),s(g,{value:"1d",children:"1\u5929"}),s(g,{value:"7d",children:"7\u5929"})]})}),p("div",{className:K.info,children:[p("span",{children:["\u6700\u540E\u66F4\u65B0\uFF1A",c!=null&&c.updateTime?new Date(c.updateTime).format("yyyy-MM-dd hh:mm:ss"):"\u4ECE\u672A"]}),s("span",{className:`ml-2 font-bold ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,onClick:()=>{C(c)},children:"\u624B\u52A8\u66F4\u65B0"})]})]})]})},c==null?void 0:c.name)]})},W=[{name:"\u81EA\u52A8\u66F4\u65B0",field:"autoUpdate"},{name:"\u6C38\u4E0D\u65AD\u7F51",field:"neverOffline"},{name:"\u5F00\u673A\u81EA\u542F",field:"autoStart"},{name:"\u81EA\u52A8\u4E3B\u9898",field:"autoTheme"},{name:"\u901A\u77E5\u670D\u52A1",field:"noticeService"}],ot=({className:n=""})=>{const a=Y(),{config:t}=z(r=>r.base),e=k.exports.useMemo(()=>t?W.map(r=>({...r,value:t[r.field]})):W.map(r=>({...r,value:!1})),[W,t]);return s("div",{className:`${n}`,children:e.map((r,o)=>p("label",{className:`flex flex-row items-center justify-between mb-1 px-4 py-2 ${le.row}`,children:[s("div",{className:`${le.name}`,children:r.name}),s(fe,{checked:r.value,onChange:u=>{a(He({[r.field]:u}))}})]},o))})},mt=()=>{var d,c;const n=Y(),{theme:a}=z(m=>m.base),{hosts:t,host:e}=z(m=>m.host),[r,o]=et(),u=m=>{m!==e&&(n(M(m!=null?m:null)),o())},i=Ze(async m=>{const O=t.map(w=>w.name===(e==null?void 0:e.name)?{...w,content:m!=null?m:""}:w),C=await P(O);C&&(n(R(C)),n(M(e?{...e,content:m!=null?m:""}:null)))},500),l=async m=>{(e==null?void 0:e.type)!=="system"&&i(m)},N=(e==null?void 0:e.type)==="system"?Je(t):(d=e==null?void 0:e.content)!=null?d:"";return p("div",{className:`main ${G.container}`,children:[p("div",{className:`w-[240px] flex flex-col pr-4 ${G.left}`,children:[s(lt,{className:"mb-4",onChange:u,onHostsChange:()=>{(e==null?void 0:e.type)==="system"&&o()},current:(c=e==null?void 0:e.name)!=null?c:null}),s(st,{className:"mb-4 mt-2"}),s(ot,{className:"w-[240px]"})]}),s("div",{className:`relative flex flex-col flex-grow rounded-lg overflow-hidden ${(e==null?void 0:e.mode)==="edit"?"":G["not-allow-edit"]}`,children:s(Me,{height:"100%",theme:a==="dark"?"vs-dark":"vs-light",defaultValue:String(N),onChange:l},`${e==null?void 0:e.name}-${r}`)})]})};export{mt as default};
