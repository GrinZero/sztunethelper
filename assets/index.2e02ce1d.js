import{a as j,r as h,R as oe,I as ie,j as t,b as f,T as ce,B as le,s as Q,c as re,d as de,F as _,e as fe,M as me,f as he,g as pe,h as we,_ as ee,i as se,u as te,k as xe,l as ge,m as Fe,n as Ee,o as Ne,p as ve,q as X,t as R,v as Y,w as Be}from"./index.8fe12b5a.js";import{S as ye}from"./index.6e4a88c3.js";import{l as ne}from"./login.7eefc438.js";async function Ce(){return j.send("getNetInfo")}const Ae=async e=>{var a;const n=await j.send("fetchPlatformList",{cookie:e}),i=(a=await window.storage.get("nameStore"))!=null?a:{};return n.data.list.forEach(l=>{const c=i[l.id],r=i[l.ip];if(!(!c&&!r)){if(c===r){l.name=c;return}r&&(l.name=r)}}),n},ae=async(e,n)=>j.send("offlinePlatform",{link:e,cookie:n}),Se=async({username:e,password:n})=>j.send("connect",{username:e,password:n}),ke=e=>{const[n,i]=h.exports.useState(0),[a,l]=h.exports.useState(0),[c,r]=h.exports.useState([]),[d,E]=h.exports.useState(0),[u,B]=h.exports.useState(0),[k,y]=h.exports.useState(0);return h.exports.useEffect(()=>{if(!e)return;const w=setInterval(()=>{const x=window.navigator.connection;x&&(B(x.downlink),y(x.rtt));const N=new Image,A=new Date().getTime();N.src=`https://www.baidu.com/favicon.ico?d=${A}`,N.onload=()=>{const o=new Date().getTime()-A;if((a+1)%5===0){const m=Math.max(o,...c),p=Math.min(o,...c);E(m-p),r([])}else r(m=>[...m,o]);l(a+1),i(o)},N.onerror=C=>{console.error("useSpeed:error",C)}},5e3);return()=>{clearInterval(w)}},[a,c,e]),[n,d,u,k]};function De(e,n){const i=h.exports.useContext(ie),a=i.prefixCls,l=a===void 0?"arco":a,c=e.spin,r=e.className,d={"aria-hidden":!0,focusable:!1,ref:n,...e,className:`${r?r+" ":""}${l}-icon ${l}-icon-sync`};return c&&(d.className=`${d.className} ${l}-icon-loading`),delete d.spin,delete d.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...d,children:t("path",{d:"M11.98 11.703c-6.64 6.64-6.64 17.403 0 24.042a16.922 16.922 0 0 0 8.942 4.7M34.603 37.156l1.414-1.415c6.64-6.639 6.64-17.402 0-24.041A16.922 16.922 0 0 0 27.075 7M14.81 11.982l-1.414-1.414-1.414-1.414h2.829v2.828ZM33.192 36.02l1.414 1.414 1.414 1.415h-2.828V36.02Z"})})}const L=oe.forwardRef(De);L.defaultProps={isIcon:!0};L.displayName="IconSync";const $e=L,Ie=({ip:e,name:n,startTime:i,endTime:a,beforeNode:l,afterNode:c,className:r="",id:d,onChange:E,current:u})=>{const B=new Date(i).getTime(),y=(a?new Date(a):new Date).getTime()-B,w=Math.floor(y/(24*3600*1e3)),x=y%(24*3600*1e3),N=Math.floor(x/(3600*1e3)),A=x%(3600*1e3),C=Math.floor(A/(60*1e3)),o=w>0?`${w}d ${N}h ${C}min`:`${N}h ${C}min`;return f("div",{className:`flex flex-row w-full py-[10px] px-[18px] justify-between items-center ${r}`,children:[l,f("span",{className:"w-[135px]",children:[u!==void 0&&t(ce,{content:"\u672C\u673A",children:t("span",{className:`mr-2 transition-all cursor-default ${u?"visible":"invisible"}`,children:"\u25B6"})}),e]}),t(le,{className:`mr-[15px] overflow-hidden text-clip ${Q["ip-row-input"]}`,defaultValue:n!=null?n:"",placeholder:"\u8F93\u5165\u8BBE\u5907\u540D",onFinished:m=>E==null?void 0:E({val:m,id:d,ip:e})}),t("span",{className:"w-[175px] select-text",children:i}),t("span",{className:`w-[70px] ${Q["ip-row-status"]}`,"data-status":!a,children:a?"\u79BB\u7EBF":"\u5728\u7EBF"}),t("span",{className:"w-[144px]",children:o}),c]})},{Title:Pe}=ee,be=({platformList:e,currentIP:n,onOffline:i,onNameChange:a,onFlush:l})=>{const c=h.exports.useMemo(()=>e===null?t("div",{className:"flex justify-center items-center w-full h-[140px]",children:t(re,{spin:!0})}):e.length===0?t("div",{className:"flex justify-center items-center w-full h-[140px]",children:t(de,{})}):e.map(u=>t(Ie,{current:u.ip===n,afterNode:f(_,{children:[t(fe,{className:"ml-6 whitespace-nowrap",theme:"danger",onClick:()=>i(u),disabled:u.endTime!==null,children:"\u4E0B\u7EBF"}),t(me,{triggerClassName:"ml-3",infoList:[u.id,u.nasIP]})]}),onChange:a,...u},u.id)),[e]),[r,d]=h.exports.useState(!1);return f(_,{children:[f(Pe,{className:"mb-2 ml-1 flex flex-row items-center",children:[t(he,{position:"right",content:"\u57FA\u4E8EIP\u548C\u4F1A\u8BDDID\u662F\u5426\u76F8\u540C\u5224\u65AD\u662F\u5426\u4E3A\u540C\u4E00\u8BBE\u5907\uFF0C\u6682\u65F6\u65E0\u6CD5\u89C4\u907FIP\u53D8\u52A8\u5BFC\u81F4\u81EA\u5B9A\u4E49\u8BBE\u5907\u540D\u79F0\u4E22\u5931\u7684\u60C5\u51B5",children:t("svg",{className:"icon mr-1 cursor-help",children:t("use",{xlinkHref:"#icon-xiangmu"})})}),t("span",{children:"\u8BBE\u5907\u5217\u8868"}),t("div",{onClick:()=>{const u=setTimeout(()=>{d(!0)},200);l().finally(()=>{clearTimeout(u),d(!1)})},children:t($e,{className:"ml-2 cursor-pointer",spin:r})})]}),t(pe,{className:`min-h-[145px] ${we["platform-list"]}`,autoHeight:!0,children:c})]})},P=({name:e,value:n,type:i})=>f("div",{className:"flex flex-row items-center justify-between",children:[f("div",{className:"flex flex-row items-center font-bold",children:[t(ye,{className:"mr-1",type:i}),t("span",{className:"mr-1 mt-[1px] text-xs select-text",children:e})]}),t("span",{className:"opacity-80 hover:opacity-100 transition-opacity select-text",children:n})]}),Me=({netInfo:e,className:n=""})=>{var i,a;return f(se,{title:"\u7F51\u7EDC\u4FE1\u606F",className:`${n}`,children:[t(P,{name:"IP",value:e.ip.value,type:e.ip.type}),t(P,{name:"DNS",value:(i=e.dns.value[0])!=null?i:"",type:e.dns.type}),e.dns.value[1]&&t(P,{name:"",value:(a=e.dns.value[1])!=null?a:"",type:"normal"}),e.wifiName&&t(P,{name:"WIFI",value:e.wifiName.value,type:e.wifiName.type}),t(P,{name:"DHCP",value:e.dhcp.value,type:e.dhcp.type})]})},{Title:Te}=ee,je=()=>{var n,i;const{currentDuty:e}=te(a=>a.center);return t("div",{className:"flex flex-col mt-4",children:!e||e==="loading"?t("div",{className:"w-full flex flex-col items-center h-[200px] justify-center",children:t(xe,{size:"large"})}):f(_,{children:[f(Te,{className:"ml-3",children:["\u5F53\u524D\u503C\u73ED",e!=null&&e.name?`\uFF1A${e==null?void 0:e.name}`:""]}),t(se,{className:"mt-1 h-full",title:"",itemClassName:"w-full h-full mt-0",listClassName:"w-full h-full",children:f("div",{className:"flex flex-col items-center justify-evenly max-h-full h-full",children:[t("p",{children:e==null?void 0:e.desc}),t(ge,{allowHalf:!0,readonly:!0,value:(n=e==null?void 0:e.rate)!=null?n:0}),t("img",{className:"object-cover rounded-[9px] mt-3 select-none overflow-hidden",width:180,height:180,src:(i=e==null?void 0:e.avatarUrl)!=null?i:""})]})})]})})},Re="/sztunethelper/assets/connecting.0abcdb2e.mp4",_e="/sztunethelper/assets/logging.63b4645c.mp4",Le="/sztunethelper/assets/no-net.83c5971a.svg",He=async(e,n)=>{var a,l;const i=await ne(n);await ae(e,(l=(a=i.data)==null?void 0:a.cookies)!=null?l:"")},Ue=()=>{const e=Fe(),n=Ee(),i=Ne(["/index"]),a=ve(),l=i===null,[c,r]=h.exports.useState([]),[d,E]=h.exports.useState("offline"),u=o=>{window.storage.set("netStatus",o),E(o)},B=te(o=>o.netInfo),[k,y]=ke(d==="success"),w=async o=>{var W,z,O,U,V,Z,q,M,J,G;const m=await window.storage.get("username"),p=await window.storage.get("password");if(console.info("login:username",m),!m||!p){u("offline"),n.push("/login");return}const g=async()=>{if(console.info("init#getCookie:start"),sessionStorage.getItem("cookie")&&o!=="refresh"){u("connect");return}const F=await ne({username:m,password:p});F.code===200?(sessionStorage.setItem("cookie",F.data.cookies),u("connect")):u("offline"),console.info("init#getCookie:end")},b=async()=>{try{const s=await Ce();if(s.code===200)return e(Be(s.data)),s.data}catch(s){console.error(s)}return null},D=async(s,F)=>{if(s===null)return;r(null);const v=await Ae(s);r(v.data.list);const I=v.data.list.find(T=>T.ip===F);!I||await window.storage.set("currentPlatform",I)},$=async(s,F)=>{var I,T,K;const v=await window.storage.get("currentPlatform");if(v&&v.user!==m){const S=(I=await window.storage.get("accountStore"))!=null?I:[];await He(v.link,{username:v.user,password:(K=(T=S.find(ue=>ue.username===v.user))==null?void 0:T.password)!=null?K:""})}try{const S=await Se({username:m,password:p});S.code===200?(u("success"),S.msg==="login success"&&await D(s,F)):u("offline")}catch(S){console.error(S)}},H=()=>{R.confirm({title:"\u8054\u7F51\u63D0\u793A",content:"\u522B\u6025\uFF01\u5173\u6389\u7CFB\u7EDF\u5F39\u51FA\u7684\u4E0A\u7F51\u8BA4\u8BC1\u7A97\u53E3\uFF0C\u70B9\u51FB\u786E\u8BA4\u5373\u53EF\uFF01",onOk:()=>{n.push("/index?refresh")},hideCancel:!0}),u("offline")};try{const s=await b();if(((W=s==null?void 0:s.wifiName)==null?void 0:W.type)==="fail")throw new Error("\u672A\u8FDE\u63A5\u6307\u5B9AWIFI");(z=s==null?void 0:s.proxy)!=null&&z.value&&R.confirm({title:"\u68C0\u6D4B\u5230\u60A8\u5F00\u542F\u4E86\u4EE3\u7406",content:f("div",{children:[t("p",{children:"\u5982\u60A8\u5F53\u524D\u6253\u5F00\u7F51\u9875\u63D0\u793A\u3010\u4EE3\u7406\u670D\u52A1\u5668\u53EF\u80FD\u6709\u95EE\u9898\u3011"}),t("p",{className:"mt-3",children:"\u8BE5\u95EE\u9898\u7684\u539F\u56E0\u662F\u60A8\u7684\u4EE3\u7406\u670D\u52A1\u5668\u4E0D\u6B63\u5E38\uFF0C\u8BF7\u5173\u95ED\u4EE3\u7406\u540E\u91CD\u8BD5"})]}),hideCancel:!0}),await g();const F=sessionStorage.getItem("cookie");await D(F,(O=s==null?void 0:s.ip)==null?void 0:O.value),$(F,(U=s==null?void 0:s.ip)==null?void 0:U.value)}catch(s){if(console.error("error:init",s),s.message==="\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"){Y.error({content:"\u672A\u8FDE\u63A5\u6307\u5B9AWIFI"}),u("offline");return}if((s==null?void 0:s.code)===502&&((V=s==null?void 0:s.data)==null?void 0:V.code)===-1&&((Z=s==null?void 0:s.data)==null?void 0:Z.cookies)===null){Y.error({content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8D26\u53F7\u5BC6\u7801\u662F\u5426\u6B63\u786E"}),u("offline"),n.push("/login");return}if((s==null?void 0:s.code)===-1&&((J=(M=(q=s==null?void 0:s.data)==null?void 0:q.message)==null?void 0:M.includes)==null?void 0:J.call(M,"connect ENETUNREACH 47.98.217.39"))){H();return}if((s==null?void 0:s.code)===502&&((G=s==null?void 0:s.data)==null?void 0:G.code)===-10056){H();return}}},x=h.exports.useCallback(()=>{d==="offline"&&(u("logging"),w())},[d]),N=o=>{R.confirm({title:"\u786E\u8BA4\u4E0B\u7EBF",content:`\u786E\u8BA4\u4E0B\u7EBF${o.ip}\u5417\uFF1F`,onOk:async()=>{var m,p;ae(o.link,(m=sessionStorage.getItem("cookie"))!=null?m:""),o.ip===B.ip.value&&u("offline"),r((p=c==null?void 0:c.map(g=>g.link===o.link?{...g,endTime:new Date().format("yyyy-MM-dd hh:mm:ss")}:g))!=null?p:null)}})},A=async({val:o,id:m,ip:p})=>{var b,D;const g=(b=await window.storage.get("nameStore"))!=null?b:{};r((D=c==null?void 0:c.map($=>$.id===m?{...$,name:o}:$))!=null?D:null),g[m]=o,g[p]=o,await window.storage.set("nameStore",g)},C=h.exports.useMemo(()=>{const o=(()=>{switch(d){case"offline":return t("img",{src:Le,width:270});case"logging":return t("video",{autoPlay:!0,loop:!0,src:_e,width:360,className:"mix-blend-multiply",preload:"auto"});case"connect":return t("video",{autoPlay:!0,loop:!0,src:Re,width:360,className:"mix-blend-color-burn",preload:"auto"});default:return f("div",{className:"text-3xl",children:[f("div",{children:["\u5EF6\u8FDF\uFF1A",k,"ms"]}),f("div",{children:["\u6296\u52A8\uFF1A",y,"ms"]})]})}})();return t("div",{className:`w-full min-h-[380px] h-full mt-6 rounded-[15px] ${X["main__background-card"]} ${X[`main__background-card__${d}`]}`,onClick:x,children:t("div",{className:"w-full h-full flex items-center justify-center text-[45px]",children:o})})},[d,x,k,y]);return h.exports.useEffect(()=>{w()},[]),h.exports.useEffect(()=>{a.search==="?refresh"&&w("refresh")},[a]),t("div",{className:`main ${l?"main-hidden":""}`,children:f("div",{className:"flex flex-grow-0 flex-shrink-0 w-full h-full",children:[f("div",{className:"flex flex-col h-full max-w-[220px]",children:[t(Me,{className:"min-w-[220px]",netInfo:B}),t(je,{})]}),f("div",{className:"flex flex-col ml-6 w-full h-full",children:[t(be,{platformList:c,currentIP:B.ip.value,onOffline:N,onNameChange:A,onFlush:w}),C]})]})})};export{Ue as default};
